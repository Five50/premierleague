{% load i18n %}
<!-- Cart Sidebar Overlay -->
<div x-show="$store.cart.isOpen" 
     x-init="$watch('$store.cart.isOpen', value => animateCartSidebar && animateCartSidebar(value))"
     @click="$store.cart.isOpen = false"
     class="cart-overlay fixed inset-0 bg-black/20"
     style="z-index: 9998; display: none;"
     x-cloak>
</div>

<!-- Cart Sidebar -->
<div x-show="$store.cart.isOpen" 
     class="cart-sidebar fixed right-0 top-0 h-full bg-white shadow-2xl overflow-y-auto"
     style="width: 384px; max-width: 100vw; z-index: 9999; display: none;"
     x-cloak>
    <!-- Cart Header -->
    <div class="bg-white border-b border-stone-200 p-6 sticky top-0 z-10">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-slate-900">{% trans "Shopping Cart" %}</h2>
            {% include 'atoms/cart-close-button.html' %}
        </div>
    </div>
    
    <!-- Cart Content -->
    <div class="p-6 bg-white">
        
        <!-- Empty Cart -->
        <template x-if="$store.cart.items.length === 0">
            <div class="text-center py-12">
                <svg class="w-20 h-20 text-stone-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                </svg>
                <h3 class="text-lg font-semibold text-slate-900 mb-2">{% trans "Your cart is empty" %}</h3>
                <p class="text-slate-600 mb-6">{% trans "Add items to get started" %}</p>
                <a href="{% url 'products' %}" 
                   @click="$store.cart.isOpen = false"
                   class="inline-block bg-yellow-400 text-gray-900 px-6 py-3 rounded-lg font-semibold hover:bg-yellow-500 transition">
                    {% trans "Browse Products" %}
                </a>
            </div>
        </template>
        
        <!-- Cart Items -->
        <template x-if="$store.cart.items.length > 0">
            <div>
                <!-- Items List -->
                <div class="space-y-4 mb-6 max-h-[calc(100vh-400px)] overflow-y-auto pr-2">
                    <template x-for="item in $store.cart.items" :key="item.cartItemId">
                        {% include 'molecules/cart-item.html' %}
                    </template>
                </div>
                
                <!-- Cart Summary -->
                <div class="bg-stone-50 rounded-lg p-4 space-y-3">
                    <div class="flex justify-between">
                        <span class="text-slate-600">{% trans "Subtotal" %}</span>
                        <span class="font-semibold text-slate-900">$<span x-text="$store.cart.subtotal.toFixed(2)"></span></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-600">{% trans "Shipping" %}</span>
                        <span class="font-medium" x-text="$store.cart.shipping === 0 ? '{% trans "FREE" %}' : '$' + $store.cart.shipping.toFixed(2)" 
                              :class="$store.cart.shipping === 0 ? 'text-blue-600' : 'text-slate-900'"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-slate-600">{% trans "Tax" %}</span>
                        <span class="font-medium text-slate-900">$<span x-text="$store.cart.tax.toFixed(2)"></span></span>
                    </div>
                    <div class="flex justify-between text-lg font-bold pt-3 border-t border-stone-200">
                        <span class="text-slate-900">{% trans "Total" %}</span>
                        <span class="text-slate-900">$<span x-text="$store.cart.total.toFixed(2)"></span></span>
                    </div>
                </div>
                
                <!-- Free Shipping Progress -->
                <div x-show="$store.cart.subtotal < 75" class="mt-4 bg-blue-50 rounded-lg p-3">
                    <p class="text-sm text-blue-950 mb-2">
                        {% trans "Add" %} <span class="font-bold">$<span x-text="(75 - $store.cart.subtotal).toFixed(2)"></span></span> {% trans "for free shipping!" %}
                    </p>
                    <div class="bg-blue-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                             :style="`width: ${Math.min(100, ($store.cart.subtotal/75)*100)}%`"></div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="mt-6 space-y-3">
                    <a href="{% url 'checkout' %}" 
                       @click="$store.cart.isOpen = false"
                       class="block w-full px-6 py-3 bg-yellow-400 text-gray-900 text-center rounded-lg font-semibold hover:bg-yellow-500 transition shadow-md hover:shadow-lg">
                        {% trans "Proceed to Checkout" %}
                    </a>
                    <a href="{% url 'cart:view_cart' %}" 
                       @click="$store.cart.isOpen = false"
                       class="block w-full px-6 py-3 bg-white border-2 border-stone-200 text-slate-700 text-center rounded-lg font-semibold hover:bg-stone-50 transition">
                        {% trans "View Cart" %}
                    </a>
                    <button @click="$store.cart.isOpen = false" 
                            class="block w-full px-6 py-2 text-slate-600 text-center text-sm hover:text-slate-800 transition">
                        {% trans "Continue Shopping" %}
                    </button>
                </div>
            </div>
        </template>
    </div>
</div>