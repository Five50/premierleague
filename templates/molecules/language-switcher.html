{% load i18n %}
{% load url_translate %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}

<div class="relative language-switcher">
    <button type="button" 
            class="language-switcher-toggle flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-colors text-slate-100 bg-slate-800 hover:text-white hover:bg-slate-700 border border-current rounded-md"
            aria-label="{% trans 'Change language' %}"
            aria-expanded="false">
        <svg class="w-4 h-4" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
        </svg>
        <span class="text-xs uppercase">{{ LANGUAGE_CODE }}</span>
        <svg class="language-switcher-arrow w-3 h-3 transition-transform" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
    </button>
    
    <div class="language-switcher-dropdown absolute bottom-full mb-2 right-0 w-48 bg-slate-800 rounded-md shadow-lg py-1 z-50 hidden -translate-y-2 transition-all duration-300 ease-out">
        {% for language in languages %}
            {% if language.code != LANGUAGE_CODE %}
            {% translate_url language.code as target_url %}
            <a href="{{ target_url }}" 
               class="block w-full text-left px-4 py-2 text-sm text-slate-600 hover:text-white hover:bg-slate-700 transition-colors"
               onclick="setLanguageCookie('{{ language.code }}')">
                {{ language.name_local|capfirst }}
            </a>
            {% endif %}
        {% endfor %}
    </div>
</div>

<script>
function setLanguageCookie(language) {
    document.cookie = "django_language=" + language + ";path=/;max-age=31536000;SameSite=Lax";
}
</script>